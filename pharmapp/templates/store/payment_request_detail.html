{% extends 'partials/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>Payment Request Details</h2>
        </div>
    </div>
    
    <div class="card mt-4">
        <div class="card-header">
            <h5>{{ payment_request.request_id }}</h5>
            <span class="badge 
                {% if payment_request.status == 'pending' %}badge-warning
                {% elif payment_request.status == 'accepted' %}badge-info
                {% elif payment_request.status == 'completed' %}badge-success
                {% elif payment_request.status == 'rejected' %}badge-danger
                {% else %}badge-secondary{% endif %}">
                {{ payment_request.get_status_display }}
            </span>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>From:</strong> {{ payment_request.dispenser.username }}</p>
                    <p><strong>Date Created:</strong> {{ payment_request.created_at|date:"M d, Y H:i" }}</p>
                    {% if payment_request.accepted_at %}
                        <p><strong>Accepted At:</strong> {{ payment_request.accepted_at|date:"M d, Y H:i" }}</p>
                    {% endif %}
                    {% if payment_request.completed_at %}
                        <p><strong>Completed At:</strong> {{ payment_request.completed_at|date:"M d, Y H:i" }}</p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <p><strong>Customer:</strong> 
                        {% if payment_request.customer %}
                            {{ payment_request.customer.name }}
                        {% else %}
                            Walk-in Customer
                        {% endif %}
                    </p>
                    <p><strong>Total Amount:</strong> ₦{{ payment_request.total_amount|floatformat:2 }}</p>
                    {% if payment_request.cashier %}
                        <p><strong>Processed by:</strong> {{ payment_request.cashier.name }}</p>
                    {% endif %}
                </div>
            </div>
            
            {% if payment_request.notes %}
                <div class="row mt-3">
                    <div class="col-md-12">
                        <h6>Notes:</h6>
                        <p>{{ payment_request.notes }}</p>
                    </div>
                </div>
            {% endif %}
            
            <div class="row mt-4">
                <div class="col-md-12">
                    <h6>Items:</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Item Name</th>
                                    <th>Brand</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Discount</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in payment_request.items.all %}
                                    <tr>
                                        <td>{{ item.item_name }}</td>
                                        <td>{{ item.brand|default:"-" }}</td>
                                        <td>{{ item.quantity }} {{ item.unit }}</td>
                                        <td>₦{{ item.unit_price|floatformat:2 }}</td>
                                        <td>₦{{ item.discount_amount|floatformat:2 }}</td>
                                        <td>₦{{ item.subtotal|floatformat:2 }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            {% if payment_request.status == 'completed' and payment_request.receipt %}
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> 
                            <strong>Completed!</strong> Receipt generated: 
                            <a href="{% url 'store:receipt_detail' payment_request.receipt.receipt_id %}" 
                               class="btn btn-sm btn-primary ml-2">View Receipt</a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-3">
        <a href="{% url 'store:payment_requests' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to My Payment Requests
        </a>
    </div>
</div>
{% endblock %}
